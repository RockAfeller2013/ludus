# yaml-language-server: $schema=https://docs.ludus.cloud/schemas/range-config.json
ludus:
  - vm_name: "{{ range_id }}-DC1"
    hostname: "{{ range_id }}-DC{{ ('abcdefghijklmnopqrstuvwxyz0123456789' | list | random) }}"
    template: win2022-server-x64-template
    vlan: 10
    ip_last_octet: 11
    ram_gb: 8
    cpus: 4
    windows:
      sysprep: false
      chocolatey_ignore_checksums: true
      gpos:
        - disable_defender   # Create and link a GPO this disables Windows Defender for every domain joined Windows machine
      #additional_powershell: |
      #  Invoke-WebRequest -Uri "https://defense-sensor-kits-ap-southeast-2.s3.ap-southeast-2.amazonaws.com/prodsyd/windows/installer_vista_win7_win8-64-4.0.3.2029.msi?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20250718T023038Z&X-Amz-SignedHeaders=host&X-Amz-Expires=604800&X-Amz-Credential=AKIAR5TRR7E6YGPSQHO3%2F20250718%2Fap-southeast-2%2Fs3%2Faws4_request&X-Amz-Signature=42d29dd5e35edc2e7547b2e3ba596bb9badf53e5719b7c1297fb9e5bf837353b" -OutFile "$env:TEMP\sensor.msi"
      #  Start-Process msiexec -ArgumentList "/q /i `"$env:TEMP\sensor.msi`" COMPANY_CODE=ZVFJP6Q4W5IJ0MN15L95 POLICY_NAME=CBCDEMO_EDR GROUP_NAME=CBCDEMO1 /L* `"$env:TEMP\cbcinstall.log`"" -Wait
    domain:
      fqdn: ludus.domain
      role: primary-dc

  - vm_name: "{{ range_id }}-WIN10-1"
    hostname: "{{ range_id }}-WIN10-1{{ ['a','b','c'] | random }}"
    hostname: "{{ range_id }}-WIN10-{{ ('abcdefghijklmnopqrstuvwxyz0123456789' | list | random) }}"
    template: win10-22h2-x64-enterprise-template
    vlan: 10
    ip_last_octet: 21
    ram_gb: 8
    cpus: 4
    windows:
      install_additional_tools: true
      chocolatey_ignore_checksums: true
      chocolatey_packages:
        - vscodium
        - firefox
        - thunderbird
        - classic-shell
        - sublimetext4
        - winscp
      office_version: 2019
      office_arch: 64bit
      #additional_powershell: |
      #  Invoke-WebRequest -Uri "https://defense-sensor-kits-ap-southeast-2.s3.ap-southeast-2.amazonaws.com/prodsyd/windows/installer_vista_win7_win8-64-4.0.3.2029.msi?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20250718T023038Z&X-Amz-SignedHeaders=host&X-Amz-Expires=604800&X-Amz-Credential=AKIAR5TRR7E6YGPSQHO3%2F20250718%2Fap-southeast-2%2Fs3%2Faws4_request&X-Amz-Signature=42d29dd5e35edc2e7547b2e3ba596bb9badf53e5719b7c1297fb9e5bf837353b" -OutFile "$env:TEMP\sensor.msi"
       # Start-Process msiexec -ArgumentList "/q /i `"$env:TEMP\sensor.msi`" COMPANY_CODE=ZVFJP6Q4W5IJ0MN15L95 POLICY_NAME=CBCDEMO_EDR GROUP_NAME=CBCDEMO1 /L* `"$env:TEMP\cbcinstall.log`"" -Wait
    domain:
      fqdn: ludus.domain
      role: member

  - vm_name: "{{ range_id }}-kali"
    hostname: "{{ range_id }}-kali"
    template: kali-x64-desktop-template
    vlan: 99
    ip_last_octet: 1
    ram_gb: 8
    cpus: 4
    linux: true
    testing:
      snapshot: false
      block_internet: false

network:
  inter_vlan_default: REJECT
  rules:
    - name: Only allow windows to kali on 443
      vlan_src: 10
      vlan_dst: 99
      protocol: tcp
      ports: 443
      action: ACCEPT
    - name: Only allow windows to kali on 80
      vlan_src: 10
      vlan_dst: 99
      protocol: tcp
      ports: 80
      action: ACCEPT
    - name: Only allow windows to kali on 8080
      vlan_src: 10
      vlan_dst: 99
      protocol: tcp
      ports: 8080
      action: ACCEPT          
    - name: Allow kali to all windows
      vlan_src: 99
      vlan_dst: 10
      protocol: all
      ports: all
      action: ACCEPT

# ver demo2 2.0
